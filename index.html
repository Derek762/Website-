<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Derek Sun | JoJo Stand Game</title>
    <style>
        body {
            font-family: 'Arial Black', Arial, sans-serif;
            background: #181c24;
            color: #e0e6ed;
            text-align: center;
            padding: 0;
            margin: 0;
        }
        header.hero {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 260px;
            background: linear-gradient(135deg, #232526 0%, #414345 100%);
            padding-top: 32px;
        }
        header.hero h1 {
            font-size: 3em;
            margin-bottom: 0.2em;
            color: #fff;
            text-shadow: 2px 2px 8px #181c24, 0 0 16px #000;
        }
        header.hero p {
            font-size: 1.3em;
            color: #e0e6ed;
            max-width: 600px;
            text-shadow: 1px 1px 6px #181c24, 0 0 8px #000;
        }
        nav[aria-label] {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5em;
            margin-bottom: 32px;
            background: #232a34;
            padding: 0.5em 0;
            box-shadow: 0 2px 8px #111a22cc;
        }
        .tab-btn {
            color: #50e3c2;
            font-weight: bold;
            background: #232a34;
            border: 1px solid #50e3c2;
            border-radius: 8px 8px 0 0;
            padding: 12px 32px;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            font-size: 1.1em;
        }
        .tab-btn[aria-selected="true"] {
            background: #50e3c2;
            color: #181c24;
        }
        .tab-btn[aria-selected="false"]:hover {
            background: #4a90e2;
            color: #fff;
        }
        main {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 60vh;
            width: 100vw;
        }
        .tab-area {
            display: none;
            width: 100%;
            max-width: 900px;
        }
        .tab-area.active {
            display: block;
        }
        section.intro-section {
            margin: 0 auto 40px auto;
            padding: 32px 24px;
            background: #232a34;
            border-radius: 18px;
            box-shadow: 0 2px 16px #111a22cc;
            max-width: 700px;
        }
        section.game-section {
            margin: 0 auto 40px auto;
            padding: 0;
            background: #232a34;
            border-radius: 18px;
            box-shadow: 0 2px 16px #111a22cc;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: auto;
        }
        .game-container {
            width: 800px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .game-title {
            color: #50e3c2;
            text-align: center;
            width: 100%;
            margin: 24px 0 24px 0;
            font-size: 2em;
        }
        canvas#standGame {
            background: #232a34;
            display: block;
            margin: 0 auto 32px auto;
            border-radius: 12px;
            outline: 2px solid #50e3c2;
        }
        #standMenu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #181c24e0;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #standMenu > div {
            background: #232a34;
            color: #e0e6ed;
            box-shadow: 0 2px 24px #111a22cc;
            border-radius: 18px;
            max-width: 350px;
            width: 350px;
            text-align: center;
            padding: 36px 32px 32px 32px;
        }
        .stand-btn {
            background: #181c24;
            color: #50e3c2;
            margin: 8px 0;
            width: 90%;
            padding: 12px 0;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-family: 'Arial Black', Arial, sans-serif;
            transition: background 0.2s, color 0.2s;
        }
        .stand-btn:hover {
            background: #4a90e2;
            color: #fff;
        }
        /* Accessibility: focus styles */
        .tab-btn:focus, .stand-btn:focus {
            outline: 3px solid #50e3c2;
            outline-offset: 2px;
        }
        /* Responsive for mobile */
        @media (max-width: 900px) {
            .game-container, canvas#standGame { width: 98vw !important; min-width: 0; }
            section.game-section { width: 100vw; }
        }
    </style>
</head>
<body>
    <header class="hero">
        <h1>Derek Sun</h1>
        <span style="color:#50e3c2;font-size:1.1em;margin-bottom:12px;">“A journey of a thousand miles begins with a single step.”</span>
        <p>Welcome to my personal website! Explore my interests and play my custom JoJo Stand Battle Game below.</p>
    </header>
    <nav aria-label="Main navigation">
        <button class="tab-btn" id="introTabBtn" aria-controls="intro" aria-selected="true">
            <img src="https://img.icons8.com/ios-filled/32/user-male-circle.png" alt="Intro Icon" style="vertical-align:middle;margin-right:8px;width:24px;height:24px;">Introduction
        </button>
        <button class="tab-btn" id="gameTabBtn" aria-controls="gameArea" aria-selected="false">
            <img src="https://img.icons8.com/ios-filled/32/joystick.png" alt="Game Icon" style="vertical-align:middle;margin-right:8px;width:24px;height:24px;">Game
        </button>
        <button class="tab-btn" id="factsTabBtn" aria-controls="factsArea" aria-selected="false">
            <img src="https://img.icons8.com/ios-filled/32/book.png" alt="Facts Icon" style="vertical-align:middle;margin-right:8px;width:24px;height:24px;">Historical Facts
        </button>
    </nav>
    <main>
        <div id="intro" class="tab-area active" tabindex="0">
            <section class="intro-section">
                <h2 style="color:#50e3c2;margin-bottom:12px;">About Derek Sun</h2>
                <p style="font-size:1.15em;line-height:1.7;color:#e0e6ed;">
                    Hello my name is <span style="color:#4a90e2;font-weight:bold;">Derek Sun</span> and I am a rising sophmore at Debakey High School.<br><br>
                    Some of my interests are <span style="color:#50e3c2;">running</span>, <span style="color:#50e3c2;">playing video games</span>, <span style="color:#50e3c2;">art</span>, and <span style="color:#50e3c2;">eating</span>.<br><br>
                    My favorite video game is <span style="color:#4a90e2;font-weight:bold;">Terraria</span>, my favorite food is <span style="color:#4a90e2;font-weight:bold;">salad</span>, and I enjoy running with friends and drawing anime characters.
                </p>
                <p style="margin-top:24px;font-style:italic;color:#50e3c2;">Fun fact: I love drawing anime characters and running with friends!</p>
            </section>
        </div>
        <div id="gameArea" class="tab-area" tabindex="0">
            <section class="game-section">
                <div class="game-container">
                  <h2 class="game-title">JoJo Stand Battle Game</h2>
                  <canvas id="standGame" width="800" height="320" aria-label="JoJo Stand Battle Game" tabindex="0"></canvas>
                </div>
                <!-- Stand Selection Menu -->
                <div id="standMenu" aria-modal="true" role="dialog" aria-label="Stand Selection">
                    <div>
                        <h2 style="color:#50e3c2;margin-bottom:18px;">Choose Your Stand</h2>
                        <button class="stand-btn" data-stand="Star Platinum">Star Platinum<br><span style='font-size:0.8em;font-weight:normal;'>Ability: ORA Rush (rapid punches)</span></button><br>
                        <button class="stand-btn" data-stand="The World">The World<br><span style='font-size:0.8em;font-weight:normal;'>Ability: Time Stop (freeze enemies)</span></button><br>
                        <button class="stand-btn" data-stand="Crazy Diamond">Crazy Diamond<br><span style='font-size:0.8em;font-weight:normal;'>Ability: Heal (restore health)</span></button>
                    </div>
                </div>
            </section>
        </div>
        <div id="factsArea" class="tab-area" tabindex="0" style="display:none;">
            <section class="intro-section">
                <h2 style="color:#50e3c2;margin-bottom:12px;">Interesting Historical Facts</h2>
                <ul style="text-align:left;max-width:600px;margin:0 auto;font-size:1.1em;line-height:1.7;color:#e0e6ed;list-style:none;padding:0;">
                    <li style="display:flex;align-items:center;margin-bottom:18px;">
                        <img src="images/great-wall-of-china.png" alt="Great Wall" style="margin-right:12px;width:32px;height:32px;" onerror="this.onerror=null;this.src='https://img.icons8.com/ios-filled/32/great-wall-of-china.png';">
                        The Great Wall of China is more than 13,000 miles long and was built over several dynasties.
                    </li>
                    <li style="display:flex;align-items:center;margin-bottom:18px;">
                        <img src="images/pyramid.png" alt="Pyramid" style="margin-right:12px;width:32px;height:32px;" onerror="this.onerror=null;this.src='https://img.icons8.com/ios-filled/32/pyramid.png';">
                        Cleopatra lived closer in time to the moon landing than to the construction of the Great Pyramid of Giza.
                    </li>
                    <li style="display:flex;align-items:center;margin-bottom:18px;">
                        <img src="images/clock.png" alt="Clock" style="margin-right:12px;width:32px;height:32px;" onerror="this.onerror=null;this.src='https://img.icons8.com/ios-filled/32/clock--v1.png';">
                        The shortest war in history was between Britain and Zanzibar on August 27, 1896. Zanzibar surrendered after 38 minutes.
                    </li>
                    <li style="display:flex;align-items:center;margin-bottom:18px;">
                        <img src="images/paint-palette.png" alt="Da Vinci" style="margin-right:12px;width:32px;height:32px;" onerror="this.onerror=null;this.src='https://img.icons8.com/ios-filled/32/paint-palette.png';">
                        Leonardo da Vinci could write with one hand and draw with the other at the same time.
                    </li>
                    <li style="display:flex;align-items:center;margin-bottom:18px;">
                        <img src="images/university.png" alt="Oxford" style="margin-right:12px;width:32px;height:32px;" onerror="this.onerror=null;this.src='https://img.icons8.com/ios-filled/32/university.png';">
                        Oxford University is older than the Aztec Empire.
                    </li>
                </ul>
            </section>
        </div>
    </main>
    <script>
    // Tab navigation logic (accessible)
    const introTabBtn = document.getElementById('introTabBtn');
    const gameTabBtn = document.getElementById('gameTabBtn');
    const factsTabBtn = document.getElementById('factsTabBtn');
    const introTab = document.getElementById('intro');
    const gameTab = document.getElementById('gameArea');
    const factsTab = document.getElementById('factsArea');
    introTabBtn.onclick = function() {
        introTab.classList.add('active');
        gameTab.classList.remove('active');
        factsTab.classList.remove('active');
        this.setAttribute('aria-selected', 'true');
        gameTabBtn.setAttribute('aria-selected', 'false');
        factsTabBtn.setAttribute('aria-selected', 'false');
        introTab.style.display = 'block';
        gameTab.style.display = 'none';
        factsTab.style.display = 'none';
        introTab.focus();
    };
    gameTabBtn.onclick = function() {
        introTab.classList.remove('active');
        gameTab.classList.add('active');
        factsTab.classList.remove('active');
        this.setAttribute('aria-selected', 'true');
        introTabBtn.setAttribute('aria-selected', 'false');
        factsTabBtn.setAttribute('aria-selected', 'false');
        introTab.style.display = 'none';
        gameTab.style.display = 'block';
        factsTab.style.display = 'none';
        gameTab.focus();
    };
    factsTabBtn.onclick = function() {
        introTab.classList.remove('active');
        gameTab.classList.remove('active');
        factsTab.classList.add('active');
        this.setAttribute('aria-selected', 'true');
        introTabBtn.setAttribute('aria-selected', 'false');
        gameTabBtn.setAttribute('aria-selected', 'false');
        introTab.style.display = 'none';
        gameTab.style.display = 'none';
        factsTab.style.display = 'block';
        factsTab.focus();
    };
    // Keyboard navigation for tabs
    [introTabBtn, gameTabBtn, factsTabBtn].forEach(btn => {
        btn.onkeydown = function(e) {
            if (e.key === 'ArrowRight') {
                if (btn === introTabBtn) gameTabBtn.focus();
                else if (btn === gameTabBtn) factsTabBtn.focus();
                else introTabBtn.focus();
            } else if (e.key === 'ArrowLeft') {
                if (btn === factsTabBtn) gameTabBtn.focus();
                else if (btn === gameTabBtn) introTabBtn.focus();
                else factsTabBtn.focus();
            }
        };
    });
    </script>
    <script>
    // JoJo Stand Game
    const standMenu = document.getElementById('standMenu');
    const standGameCanvas = document.getElementById('standGame');
    const standCtx = standGameCanvas.getContext('2d');
    let selectedStand = null;
    let standPlayer, standEnemies, standBullets, standGameOver, standKeys, standAbilityCooldown, standTimeStopTimer, standHealTimer;

    document.querySelectorAll('.stand-btn').forEach(btn => {
        btn.onclick = function() {
            selectedStand = this.getAttribute('data-stand');
            standMenu.style.display = 'none';
            startStandGame();
        };
    });

    function startStandGame() {
        // Player and enemy setup
        standPlayer = { x: 100, y: 220, w: 32, h: 48, vx: 0, vy: 0, onGround: true, health: 100, facing: 1, attacking: false, attackTimer: 0 };
        standEnemies = [ {
            x: 600, y: 220, w: 32, h: 48, health: 300, alive: true, vx: -1.5, stand: 'Za Hando', standTimer: 0
        } ];
        standBullets = [];
        standGameOver = false;
        standKeys = {};
        standAbilityCooldown = 0;
        standTimeStopTimer = 0;
        standHealTimer = 0;
        window.addEventListener('keydown', standKeyDown);
        window.addEventListener('keyup', standKeyUp);
        requestAnimationFrame(standGameLoop);
    }
    function standKeyDown(e) { standKeys[e.key] = true; }
    function standKeyUp(e) { standKeys[e.key] = false; }

    function standGameLoop() {
        // Update
        if (!standGameOver) standUpdate();
        standDraw();
        if (!standGameOver) requestAnimationFrame(standGameLoop);
    }
    function standUpdate() {
        // Movement
        if (standKeys['ArrowLeft'] || standKeys['a']) { standPlayer.vx = -3; standPlayer.facing = -1; }
        else if (standKeys['ArrowRight'] || standKeys['d']) { standPlayer.vx = 3; standPlayer.facing = 1; }
        else standPlayer.vx = 0;
        if ((standKeys[' '] || standKeys['w'] || standKeys['ArrowUp']) && standPlayer.onGround) {
            standPlayer.vy = -10;
            standPlayer.onGround = false;
        }
        standPlayer.x += standPlayer.vx;
        standPlayer.y += standPlayer.vy;
        standPlayer.vy += 0.5; // gravity
        if (standPlayer.y >= 220) { standPlayer.y = 220; standPlayer.vy = 0; standPlayer.onGround = true; }
        // Prevent player from leaving the screen
        if (standPlayer.x < 0) standPlayer.x = 0;
        if (standPlayer.x + standPlayer.w > standGameCanvas.width) standPlayer.x = standGameCanvas.width - standPlayer.w;
        // Attack
        if (standKeys['j'] && !standPlayer.attacking) {
            standPlayer.attacking = true;
            standPlayer.attackTimer = 10;
        }
        if (standPlayer.attacking) {
            standPlayer.attackTimer--;
            if (standPlayer.attackTimer <= 0) standPlayer.attacking = false;
            // Hit enemy
            for (let enemy of standEnemies) {
                if (!enemy.alive) continue;
                let dist = Math.abs((standPlayer.x + standPlayer.w/2) - (enemy.x + enemy.w/2));
                if (dist < 48 && Math.abs(standPlayer.y - enemy.y) < 32) {
                    enemy.health -= 10;
                    if (enemy.health <= 0) enemy.alive = false;
                }
            }
        }
        // Stand abilities
        if (standAbilityCooldown > 0) standAbilityCooldown--;
        if (selectedStand === 'Star Platinum' && standKeys['k'] && standAbilityCooldown === 0) {
            // ORA Rush: rapid punches
            for (let enemy of standEnemies) {
                if (!enemy.alive) continue;
                let dist = Math.abs((standPlayer.x + standPlayer.w/2) - (enemy.x + enemy.w/2));
                if (dist < 80 && Math.abs(standPlayer.y - enemy.y) < 32) {
                    enemy.health -= 30;
                    if (enemy.health <= 0) enemy.alive = false;
                }
            }
            standAbilityCooldown = 60;
        }
        if (selectedStand === 'The World' && standKeys['k'] && standAbilityCooldown === 0) {
            // Time Stop: freeze enemies for 2 seconds
            standTimeStopTimer = 120;
            standAbilityCooldown = 300;
        }
        if (standTimeStopTimer > 0) standTimeStopTimer--;
        if (selectedStand === 'Crazy Diamond' && standKeys['k'] && standAbilityCooldown === 0) {
            // Heal: restore health
            standPlayer.health = Math.min(100, standPlayer.health + 40);
            standAbilityCooldown = 180;
            standHealTimer = 30;
        }
        // Enemy AI
        for (let enemy of standEnemies) {
            if (!enemy.alive) continue;
            if (standTimeStopTimer > 0) continue; // frozen
            // Enemy stand ability: Za Hando (teleport close to player every 5 seconds)
            enemy.standTimer++;
            if (enemy.standTimer > 300) {
                enemy.x = standPlayer.x + (Math.random() > 0.5 ? 80 : -80);
                enemy.standTimer = 0;
            }
            if (enemy.x > standPlayer.x) enemy.vx = -1.5;
            else enemy.vx = 1.5;
            enemy.x += enemy.vx;
            // Enemy attacks
            if (Math.abs(enemy.x - standPlayer.x) < 40 && Math.abs(enemy.y - standPlayer.y) < 32) {
                if (standTimeStopTimer === 0) standPlayer.health -= 0.5;
            }
        }
        // Game over
        if (standPlayer.health <= 0) standGameOver = true;
    }
    function standDraw() {
        standCtx.clearRect(0,0,standGameCanvas.width,standGameCanvas.height);
        // Ground
        standCtx.fillStyle = '#355C7D';
        standCtx.fillRect(0, 268, standGameCanvas.width, 52);
        // Player
        standCtx.save();
        standCtx.translate(standPlayer.x, standPlayer.y);
        standCtx.fillStyle = '#F8B195';
        standCtx.fillRect(0, 0, standPlayer.w, standPlayer.h);
        // Stand aura
        if (selectedStand === 'Star Platinum') {
            standCtx.strokeStyle = '#355C7D';
            standCtx.lineWidth = 4;
            standCtx.strokeRect(-4, -4, standPlayer.w+8, standPlayer.h+8);
        } else if (selectedStand === 'The World') {
            standCtx.strokeStyle = '#F67280';
            standCtx.lineWidth = 4;
            standCtx.strokeRect(-4, -4, standPlayer.w+8, standPlayer.h+8);
        } else if (selectedStand === 'Crazy Diamond') {
            standCtx.strokeStyle = '#C06C84';
            standCtx.lineWidth = 4;
            standCtx.strokeRect(-4, -4, standPlayer.w+8, standPlayer.h+8);
        }
        // Attack effect
        if (standPlayer.attacking) {
            standCtx.fillStyle = '#fff';
            standCtx.globalAlpha = 0.5;
            standCtx.fillRect(standPlayer.facing > 0 ? standPlayer.w : -24, 8, 24, 16);
            standCtx.globalAlpha = 1;
        }
        // Heal effect
        if (standHealTimer > 0) {
            standCtx.globalAlpha = 0.7;
            standCtx.fillStyle = '#C06C84';
            standCtx.fillRect(0, -12, standPlayer.w, 8);
            standCtx.globalAlpha = 1;
            standHealTimer--;
        }
        standCtx.restore();
        // Enemies
        for (let enemy of standEnemies) {
            if (!enemy.alive) continue;
            standCtx.save();
            standCtx.translate(enemy.x, enemy.y);
            standCtx.fillStyle = '#6C5B7B';
            standCtx.fillRect(0, 0, enemy.w, enemy.h);
            // Enemy stand aura
            standCtx.strokeStyle = '#4a90e2';
            standCtx.lineWidth = 4;
            standCtx.strokeRect(-4, -4, enemy.w+8, enemy.h+8);
            // Health bar
            standCtx.fillStyle = '#fff';
            standCtx.fillRect(0, -10, enemy.w, 6);
            standCtx.fillStyle = '#50e3c2';
            standCtx.fillRect(0, -10, enemy.w * (enemy.health/300), 6);
            standCtx.restore();
        }
        // UI
        standCtx.fillStyle = '#fff';
        standCtx.font = '18px Arial Black';
        standCtx.fillText('Health: ' + Math.round(standPlayer.health), 20, 30);
        standCtx.fillText('Stand: ' + selectedStand, 20, 60);
        if (selectedStand === 'Star Platinum') standCtx.fillText('K: ORA Rush', 20, 90);
        if (selectedStand === 'The World') standCtx.fillText('K: Time Stop', 20, 90);
        if (selectedStand === 'Crazy Diamond') standCtx.fillText('K: Heal', 20, 90);
        if (standAbilityCooldown > 0) standCtx.fillText('Ability Cooldown: ' + Math.ceil(standAbilityCooldown/60) + 's', 20, 120);
        if (standTimeStopTimer > 0) standCtx.fillText('Time Stopped!', 300, 60);
        if (standGameOver) {
            standCtx.save();
            standCtx.globalAlpha = 0.85;
            standCtx.fillStyle = '#22212C';
            standCtx.fillRect(0, 0, standGameCanvas.width, standGameCanvas.height);
            standCtx.globalAlpha = 1;
            standCtx.fillStyle = '#F8B195';
            standCtx.font = '48px Arial Black';
            standCtx.textAlign = 'center';
            standCtx.fillText('Game Over', standGameCanvas.width/2, standGameCanvas.height/2 - 20);
            standCtx.font = '28px Arial';
            standCtx.fillText('Refresh to play again', standGameCanvas.width/2, standGameCanvas.height/2 + 40);
            standCtx.textAlign = 'left';
            standCtx.restore();
        }
    }
    </script>
    <script>
    // Battle game with fixed grappling and visual string
    const canvas = document.getElementById('battleGame');
    const ctx = canvas.getContext('2d');
    const groundY = 250;
    let player = { x: 100, y: groundY, vy: 0, w: 32, h: 32, onGround: true, vx: 0, health: 100, attacking: false, attackTimer: 0, power: null, powerTimer: 0, grappling: false, grappleTarget: null, grappleProgress: 0, hasGrapple: false };
    let keys = {};
    let powerUps = [
        {x: 350, y: groundY, type: 'heal', active: true},
        {x: 600, y: groundY, type: 'strength', active: true},
        {x: 200, y: groundY, type: 'grapple', active: true}
    ];
    let airBlocks = [
        {x: 300, y: 180, w: 40, h: 10},
        {x: 500, y: 120, w: 40, h: 10},
        {x: 700, y: 80, w: 40, h: 10}
    ];
    let enemies = [
        {x: 700, y: groundY, w: 32, h: 32, health: 60, alive: true, attackTimer: 0, vx: 0, vy: 0}
    ];
    let bullets = [];
    let score = 0;
    let grappleCooldown = 0;
    document.addEventListener('keydown', e => { keys[e.key] = true; });
    document.addEventListener('keyup', e => { keys[e.key] = false; });
    function update() {
        // Move player
        if (!player.grappling) {
            if (keys['ArrowRight'] || keys['d']) player.vx = 4;
            else if (keys['ArrowLeft'] || keys['a']) player.vx = -4;
            else player.vx = 0;
            if ((keys[' '] || keys['ArrowUp'] || keys['w']) && player.onGround) {
                player.vy = -10;
                player.onGround = false;
            }
        }
        // Grapple (now allowed mid-air)
        if (player.power === 'grapple' && keys['k'] && !player.grappling) {
            // Find closest air block in range
            let closest = null, minDist = 120;
            for (let b of airBlocks) {
                let bx = b.x + b.w/2, by = b.y;
                let dist = Math.hypot(player.x+player.w/2 - bx, player.y - by);
                if (dist < minDist) { minDist = dist; closest = b; }
            }
            if (closest) {
                player.grappling = true;
                player.grappleTarget = {x: closest.x + closest.w/2, y: closest.y};
                player.grappleProgress = 0;
            }
        }
        if (player.grappling && player.grappleTarget) {
            // Move player toward grapple target
            let px = player.x + player.w/2, py = player.y;
            let dx = player.grappleTarget.x - px;
            let dy = player.grappleTarget.y - py;
            let dist = Math.hypot(dx, dy);
            let step = Math.min(16, dist);
            if (dist > 8) {
                player.x += (dx/dist) * step;
                player.y += (dy/dist) * step;
                player.vy = 0;
                player.grappleProgress = 1;
            } else {
                // Place player just above the block to avoid freeze
                player.x = player.grappleTarget.x - player.w/2;
                player.y = player.grappleTarget.y - player.h - 1; // 1px above
                player.grappling = false;
                player.grappleTarget = null;
                player.grappleProgress = 0;
                player.vy = -2; // Give a small upward velocity
                player.onGround = false;
                grappleCooldown = 5; // Skip landing logic for a few frames
            }
        }
        // Attack
        if (keys['j'] && !player.attacking) {
            player.attacking = true;
            player.attackTimer = 10;
        }
        if player.attacking) {
            player.attackTimer--;
            if (player.attackTimer <= 0) player.attacking = false;
            // Player can hit enemy while attacking
            for (let enemy of enemies) {
                if (!enemy.alive) continue;
                let dist = Math.hypot((player.x+player.w/2)-(enemy.x+enemy.w/2), (player.y+player.h/2)-(enemy.y+enemy.h/2));
                if (dist < 40 && enemy.health > 0) {
                    enemy.health -= (player.power === 'strength' ? 20 : 10);
                    if (enemy.health <= 0) {
                        enemy.alive = false;
                        score += 100;
                    }
                }
            }
        }
        if (!player.grappling) {
            player.x += player.vx;
            player.y += player.vy;
            player.vy += 0.5; // gravity
        }
        // Land on ground
        if (player.y >= groundY) {
            player.y = groundY;
            player.vy = 0;
            player.onGround = true;
        } else {
            player.onGround = false;
        }
        // Land on air blocks
        if (grappleCooldown > 0) {
            grappleCooldown--;
        } else {
            for (let b of airBlocks) {
                if (
                    player.x + player.w > b.x &&
                    player.x < b.x + b.w &&
                    player.y + player.h > b.y &&
                    player.y + player.h < b.y + b.h + 10 &&
                    player.vy >= 0
                ) {
                    player.y = b.y - player.h;
                    player.vy = 0;
                    player.onGround = true;
                }
            }
        }
        // Power-up collection
        for (let p of powerUps) {
            if (p.active && Math.abs(player.x - p.x) < 28 && Math.abs(player.y - p.y) < 28) {
                if (p.type === 'heal') {
                    player.health = Math.min(100, player.health + 40);
                } else if (p.type === 'strength') {
                    player.power = 'strength';
                    player.powerTimer = 200;
                } else if (p.type === 'grapple') {
                    player.hasGrapple = true;
                    player.power = 'grapple';
                    player.powerTimer = 999999; // Infinite
                }
                p.active = false;
            }
        }
        // Infinite grapple after power-up
        if (player.hasGrapple) player.power = 'grapple';
        // Enemy logic: chase player and shoot
        for (let enemy of enemies) {
            if (!enemy.alive) continue;
            let dx = player.x - enemy.x;
            if (Math.abs(dx) > 2) enemy.vx = dx > 0 ? 2 : -2;
            else enemy.vx = 0;
            enemy.x += enemy.vx;
            // Enemy attacks if close
            if (Math.abs(player.x - enemy.x) < 40 && Math.abs(player.y - enemy.y) < 28 && enemy.attackTimer === 0) {
                player.health -= 10;
                enemy.attackTimer = 30;
            }
            if (enemy.attackTimer > 0) enemy.attackTimer--;
            // Enemy shoots at player every 90 frames
            if (Math.abs(player.x - enemy.x) < 400 && Math.abs(player.y - enemy.y) < 100 && Math.random() < 1/90) {
                let angle = Math.atan2((player.y+player.h/2)-(enemy.y+enemy.h/2), (player.x+player.w/2)-(enemy.x+enemy.w/2));
                bullets.push({x: enemy.x+enemy.w/2, y: enemy.y+enemy.h/2, vx: Math.cos(angle)*6, vy: Math.sin(angle)*6, alive: true});
            }
        }
        // Update bullets
        for (let bullet of bullets) {
            if (!bullet.alive) continue;
            bullet.x += bullet.vx;
            bullet.y += bullet.vy;
            // Bullet hits player
            if (
                bullet.x > player.x && bullet.x < player.x+player.w &&
                bullet.y > player.y && bullet.y < player.y+player.h
            ) {
                player.health -= 15;
                bullet.alive = false;
            }
            // Bullet out of bounds
            if (bullet.x < 0 || bullet.x > canvas.width || bullet.y < 0 || bullet.y > canvas.height) bullet.alive = false;
        }
        // Game over if player health <= 0
        if (player.health <= 0) {
            player.health = 0;
            gameOver = true;
        }
    }
    function draw() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        // Ground
        ctx.fillStyle = '#228B22';
        ctx.fillRect(0, groundY+32, canvas.width, 50);
        // Air blocks
        ctx.fillStyle = '#888';
        for (let b of airBlocks) {
            ctx.fillRect(b.x, b.y, b.w, b.h);
        }
        // Draw grappling string
        if (player.grappling && player.grappleTarget) {
            ctx.save();
            ctx.strokeStyle = '#111';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(player.x + player.w/2, player.y);
            ctx.lineTo(player.grappleTarget.x, player.grappleTarget.y);
            ctx.stroke();
            ctx.restore();
        }
        // Power-ups
        for (let p of powerUps) {
            if (!p.active) continue;
            ctx.save();
            ctx.translate(p.x, p.y);
            if (p.type === 'heal') {
                ctx.fillStyle = '#2ecc40';
                ctx.beginPath();
                ctx.arc(0, 0, 14, 0, 2*Math.PI);
                ctx.fill();
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 16px Arial';
                ctx.fillText('+', -5, 6);
            } else if (p.type === 'strength') {
                ctx.fillStyle = '#f39c12';
                ctx.beginPath();
                ctx.arc(0, 0, 14, 0, 2*Math.PI);
                ctx.fill();
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 16px Arial';
                ctx.fillText('S', -6, 6);
            } else if (p.type === 'grapple') {
                ctx.fillStyle = '#00bfff';
                ctx.beginPath();
                ctx.arc(0, 0, 14, 0, 2*Math.PI);
                ctx.fill();
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 16px Arial';
                ctx.fillText('G', -6, 6);
            }
            ctx.restore();
        }
        // Enemies
        for (let enemy of enemies) {
            if (!enemy.alive) continue;
            ctx.fillStyle = '#c0392b';
            ctx.fillRect(enemy.x, enemy.y, enemy.w, enemy.h);
            // Enemy health bar
            ctx.fillStyle = '#fff';
            ctx.fillRect(enemy.x, enemy.y-10, enemy.w, 6);
            ctx.fillStyle = '#e74c3c';
            ctx.fillRect(enemy.x, enemy.y-10, enemy.w * (enemy.health/60), 6);
        }
        // Player
        ctx.save();
        ctx.translate(player.x, player.y);
        ctx.fillStyle = player.power === 'strength' ? '#f39c12' : '#3498db';
        ctx.beginPath();
        ctx.arc(16, 16, 16, 0, 2*Math.PI);
        ctx.fill();
        // Attack effect
        if (player.attacking) {
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.arc(16, 16, 28, 0, Math.PI*2);
            ctx.stroke();
        }
        ctx.restore();
        // Player health bar
        ctx.fillStyle = '#fff';
        ctx.fillRect(20, 50, 100, 10);
        ctx.fillStyle = '#3498db';
        ctx.fillRect(20, 50, player.health, 10);
        // Power-up indicator
        if (player.power === 'strength') {
            ctx.fillStyle = '#f39c12';
            ctx.font = '18px Arial Black';
            ctx.fillText('Strength!', 140, 60);
        } else if (player.power === 'grapple') {
            ctx.fillStyle = '#00bfff';
            ctx.font = '18px Arial Black';
            ctx.fillText('Grapple!', 140, 60);
        }
        // Score
        ctx.fillStyle = '#fff';
        ctx.font = '20px Arial Black';
        ctx.fillText('Score: '+score, 20, 30);
        // Draw bullets
        ctx.save();
        ctx.fillStyle = '#F7B32B';
        for (let bullet of bullets) {
            if (!bullet.alive) continue;
            ctx.beginPath();
            ctx.arc(bullet.x, bullet.y, 6, 0, 2*Math.PI);
            ctx.fill();
        }
        ctx.restore();
    }
    // Game over overlay and restart
    let gameOver = false;
    function drawGameOver() {
        ctx.save();
        ctx.globalAlpha = 0.85;
        ctx.fillStyle = '#22212C';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.globalAlpha = 1;
        ctx.fillStyle = '#FAFAFA';
        ctx.font = '48px Arial Black';
        ctx.textAlign = 'center';
        ctx.fillText('Game Over', canvas.width/2, canvas.height/2 - 20);
        ctx.font = '28px Arial';
        ctx.fillText('Press R to Restart', canvas.width/2, canvas.height/2 + 40);
        ctx.textAlign = 'left';
        ctx.restore();
    }
    document.addEventListener('keydown', function(e) {
        if (gameOver && (e.key === 'r' || e.key === 'R')) {
            restartGame();
        }
    });
    function restartGame() {
        player = { x: 100, y: groundY, vy: 0, w: 32, h: 32, onGround: true, vx: 0, health: 100, attacking: false, attackTimer: 0, power: null, powerTimer: 0, grappling: false, grappleTarget: null, grappleProgress: 0, hasGrapple: false };
        powerUps = [
            {x: 350, y: groundY, type: 'heal', active: true},
            {x: 600, y: groundY, type: 'strength', active: true},
            {x: 200, y: groundY, type: 'grapple', active: true}
        ];
        airBlocks = [
            {x: 300, y: 180, w: 40, h: 10},
            {x: 500, y: 120, w: 40, h: 10},
            {x: 700, y: 80, w: 40, h: 10}
        ];
        enemies = [
            {x: 700, y: groundY, w: 32, h: 32, health: 60, alive: true, attackTimer: 0, vx: 0, vy: 0}
        ];
        bullets = [];
        score = 0;
        gameOver = false;
    }
    function loop() {
        if (!gameOver) {
            update();
            draw();
        } else {
            draw();
            drawGameOver();
        }
        requestAnimationFrame(loop);
    }
    loop();
    </script>
</body>
</html>
